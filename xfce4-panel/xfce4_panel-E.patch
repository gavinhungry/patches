--- ../abs/xfce4-panel/src/xfce4-panel-4.8.6/plugins/systray/systray-socket.c.ORIG	2011-04-26 19:04:15.550912465 -0700
+++ ../abs/xfce4-panel/src/xfce4-panel-4.8.6/plugins/systray/systray-socket.c	2011-04-26 21:50:08.734179535 -0700
@@ -56,6 +56,7 @@
   GdkNativeWindow window;
 
   gchar           *name;
+  gchar           *sort; /* gavin: keep name and sort seperate */
 
   guint            is_composited : 1;
   guint            parent_relative_bg : 1;
@@ -102,6 +103,7 @@
 {
   socket->hidden = FALSE;
   socket->name = NULL;
+  socket->sort = NULL; /* gavin: init sort */
 }
 
 
@@ -112,6 +114,7 @@
   SystraySocket *socket = XFCE_SYSTRAY_SOCKET (object);
 
   g_free (socket->name);
+  g_free (socket->sort); /* gavin: sort */
 
   G_OBJECT_CLASS (systray_socket_parent_class)->finalize (object);
 }
@@ -401,6 +404,29 @@
 }
 
 
+
+/* gavin: return a sort if it's in the list, otherwise return the name */
+const gchar *
+systray_socket_get_sort (SystraySocket *socket)
+{
+  panel_return_val_if_fail (XFCE_IS_SYSTRAY_SOCKET (socket), NULL);
+
+  socket->name = systray_socket_get_name(socket);
+  socket->sort = g_strdup(socket->name);
+
+#if GLIB_CHECK_VERSION (2, 16, 0)
+  if      (!g_strcmp0(socket->sort, "dropbox"))               g_strlcpy(socket->sort, "zzzzz00", 8);
+  else if (!g_strcmp0(socket->sort, "parcellite"))            g_strlcpy(socket->sort, "zzzzz10", 8);
+  else if (!g_strcmp0(socket->sort, "blueman-applet"))        g_strlcpy(socket->sort, "zzzzz20", 8);
+  else if (!g_strcmp0(socket->sort, "networkmanager applet")) g_strlcpy(socket->sort, "zzzzz30", 8);
+  else if (!g_strcmp0(socket->sort, "xfce4-power-manager"))   g_strlcpy(socket->sort, "zzzzz40", 8);
+  else if (!g_strcmp0(socket->sort, "volatile"))              g_strlcpy(socket->sort, "zzzzz50", 8);
+#endif
+
+  return socket->sort;
+}
+
+
 
 const gchar *
 systray_socket_get_name (SystraySocket *socket)
